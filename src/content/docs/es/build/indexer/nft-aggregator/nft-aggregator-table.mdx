---
title: "Referencia de Tablas del Agregador NFT"
description: "Referencia de esquema de base de datos para tablas PostgreSQL del agregador NFT con estructura de datos de actividad de marketplace y documentación de campos"
sidebar:
  label: "Referencia de Tablas"
---

import { Aside } from '@astrojs/starlight/components';

Esta página documenta las tablas PostgreSQL generadas y actualizadas por el Agregador NFT.\
Estas tablas alimentan tanto la **API GraphQL** como la **API REST**, y reflejan el estado en vivo de la actividad de marketplace en Aptos.

Para consultas, consulta:

- **[API GraphQL del Agregador NFT](/build/indexer/nft-aggregator/graphql-api)**
- **[API REST del Agregador NFT](/build/indexer/nft-aggregator/analytics-api)**

<Aside type="note">
  Al explorar la API GraphQL, puedes ver estas tablas en el explorador de esquema. Las tablas con sufijos `_by_pk` se generan automáticamente para búsquedas de clave primaria.
</Aside>

<br />

# Resumen de Tablas del Agregador NFT

| Nombre de Tabla                            | Descripción                                       |
| ------------------------------------------ | ------------------------------------------------- |
| `nft_marketplace_activities`               | Datos históricos de todos los eventos de marketplace NFT |
| `current_nft_marketplace_listing`          | Últimos listings activos por token               |
| `current_nft_marketplace_token_offer`      | Últimas ofertas activas por token y comprador    |
| `current_nft_marketplace_collection_offer` | Últimas ofertas activas por colección            |
| `current_collections_v2`                   | Últimas colecciones activas                       |
| `current_token_datas_v2`                   | Últimos tokens activos                            |
| `current_token_ownerships_v2`              | Últimas propiedades de token activas             |
| `current_collection_ownerships_v2_view`    | Últimas propiedades de colección activas         |

## Notas

- Usa `is_deleted = false` para consultar **solo registros activos** en tablas de estado actual.
- La tabla `nft_marketplace_activities` es tu **fuente de verdad** para actividad histórica de marketplace.

## `nft_marketplace_activities`

Tabla histórica que captura todos los eventos de marketplace NFT — listings, ofertas, ventas, y más. Tiene una vista agregada para datos de resumen llamada `nft_marketplace_activities_aggregate`.

**Clave Primaria:** `txn_version, index, marketplace`

### Índices

| Nombre de Índice          | Columnas                                                  |
| ------------------------- | -------------------------------------------------------- |
| `idx_collection_event_ts` | collection\_id, standard\_event\_type, block\_timestamp DESC |
| `idx_token_id`            | token\_data\_id                                            |
| `idx_buyer`               | buyer                                                    |
| `idx_seller`              | seller                                                   |
| `idx_listing_id`          | listing\_id                                               |
| `idx_offer_id`            | offer\_id                                                 |
| `idx_timestamp`           | block\_timestamp DESC                                     |

### Campos

<Aside type="note">
  Muchos campos usan tipos `Option` porque los eventos de marketplace pueden no emitir datos completos para todos los campos. El procesador captura lo que está disponible mientras mantiene la seguridad de tipos.
</Aside>

| Campo               | Tipo                 | Descripción                             |
| ------------------- | -------------------- | --------------------------------------- |
| txn\_version         | i64                  | Versión blockchain de la transacción   |
| index               | i64                  | Índice del evento en la transacción     |
| listing\_id          | Option\<String> | ID del listing (si aplica)              |
| offer\_id            | Option\<String> | ID de la oferta (si aplica)             |
| raw\_event\_type      | String               | Tipo de evento de marketplace crudo     |
| standard\_event\_type | String               | Tipo de evento normalizado              |
| creator\_address     | Option\<String> | Dirección del creador de colección      |
| collection\_id       | Option\<String> | Identificador de colección              |
| collection\_name     | Option\<String> | Nombre de colección                     |
| token\_data\_id       | Option\<String> | Identificador de token                  |
| token\_name          | Option\<String> | Nombre de token                         |
| price               | i64                  | Precio en Octas                         |
| token\_amount        | Option\<i64>    | Cantidad de token (para bundles etc.)   |
| buyer               | Option\<String> | Dirección del comprador                 |
| seller              | Option\<String> | Dirección del vendedor                  |
| expiration\_time     | Option\<String> | Tiempo de expiración de listing/oferta |
| marketplace         | String               | Nombre del marketplace                  |
| contract\_address    | String               | Dirección del contrato del marketplace  |
| json\_data           | serde\_json::Value    | Payload de evento crudo interno (no público) |
| block\_timestamp     | NaiveDateTime        | Timestamp del bloque del evento         |

<Aside type="caution">
  `json_data` es interno y no se expone en APIs públicas.
</Aside>

## `current_nft_marketplace_listing`

Rastrea listings activos actuales. Actualizado en tiempo real.

**Clave Primaria:** `token_data_id, marketplace`

### Índices

| Nombre de Índice                                           | Columnas              |
| ---------------------------------------------------------- | -------------------- |
| `idx_current_nft_marketplace_listings_token_data_id`       | token\_data\_id        |
| `idx_current_nft_marketplace_listings_collection_id`       | collection\_id        |
| `idx_current_nft_marketplace_listings_collection_id_price` | collection\_id, price |
| `idx_current_nft_marketplace_listings_seller`              | seller               |

### Campos

| Campo                      | Tipo                 | Descripción                     |
| -------------------------- | -------------------- | ------------------------------- |
| token\_data\_id              | String               | Identificador de token          |
| listing\_id                 | Option\<String> | ID del listing                  |
| collection\_id              | Option\<String> | Identificador de colección      |
| seller                     | String               | Dirección del vendedor          |
| price                      | i64                  | Precio del listing              |
| token\_amount               | i64                  | Número de tokens listados       |
| token\_name                 | Option\<String> | Nombre del token                |
| standard\_event\_type        | String               | Tipo de evento normalizado      |
| is\_deleted                 | bool                 | True si el listing está inactivo |
| marketplace                | String               | Nombre del marketplace          |
| contract\_address           | String               | Dirección del contrato del marketplace |
| last\_transaction\_version   | i64                  | Última versión de transacción   |
| last\_transaction\_timestamp | NaiveDateTime        | Último timestamp de actualización |

## `current_nft_marketplace_token_offer`

Rastrea ofertas de token activas actuales por token y comprador.

**Clave Primaria:** `token_data_id, buyer, marketplace`

### Índices

| Nombre de Índice                                             | Columnas       |
| ------------------------------------------------------------ | ------------- |
| `idx_current_nft_marketplace_token_offers_token_data_id`     | token\_data\_id |
| `idx_current_nft_marketplace_token_offers_price`             | price         |
| `idx_current_nft_marketplace_token_offers_buyer`             | buyer         |

### Campos

| Campo                      | Tipo                 | Descripción                  |
| -------------------------- | -------------------- | ---------------------------- |
| token\_data\_id              | String               | Identificador de token       |
| offer\_id                   | Option\<String> | ID de la oferta              |
| buyer                      | String               | Dirección del comprador      |
| collection\_id              | String               | Identificador de colección   |
| price                      | i64                  | Precio de la oferta          |
| token\_amount               | Option\<i64>    | Cantidad de token            |
| token\_name                 | Option\<String> | Nombre del token             |
| standard\_event\_type        | String               | Tipo de evento normalizado   |
| bid\_key                    | Option\<i64>    | Clave de puja única          |
| is\_deleted                 | bool                 | Estado activo de la oferta   |
| marketplace                | String               | Nombre del marketplace       |
| contract\_address           | String               | Dirección del contrato del marketplace |
| last\_transaction\_version   | i64                  | Última versión de transacción |
| last\_transaction\_timestamp | NaiveDateTime        | Último timestamp de actualización |

## `current_nft_marketplace_collection_offer`

Rastrea ofertas activas actuales a nivel de colección.

**Clave Primaria:** `collection_offer_id`

### Índices

| Nombre de Índice                                                                      | Columnas                            |
| ------------------------------------------------------------------------------------- | ---------------------------------- |
| `idx_current_nft_marketplace_collection_offers_collection_id`                         | collection\_id                      |
| `idx_current_nft_marketplace_collection_offers_token_data_id`                         | token\_data\_id                      |
| `idx_current_nft_marketplace_collection_offers_collection_offer_id_token_data_id`     | collection\_offer\_id, token\_data\_id |

### Campos

| Campo                      | Tipo              | Descripción                     |
| -------------------------- | ----------------- | ------------------------------- |
| collection\_offer\_id        | String            | ID único de oferta de colección |
| token\_data\_id              | String            | Identificador de token          |
| collection\_id              | String            | Identificador de colección      |
| buyer                      | String            | Dirección del comprador         |
| price                      | i64               | Precio de la oferta             |
| remaining\_token\_amount     | Option\<i64> | Cantidad restante en la oferta  |
| standard\_event\_type        | String            | Tipo de evento normalizado      |
| is\_deleted                 | bool              | Estado activo de la oferta      |
| marketplace                | String            | Nombre del marketplace          |
| contract\_address           | String            | Dirección del contrato del marketplace |
| last\_transaction\_version   | i64               | Última versión de transacción   |
| last\_transaction\_timestamp | NaiveDateTime     | Último timestamp de actualización |

## Otras Tablas

Más información sobre tablas (ej. `current_token_datas_v2`, `current_collections_v2`, `current_token_ownerships_v2`, `current_collection_ownerships_v2_view`) está disponible [aquí](/build/indexer/indexer-api/indexer-reference)
