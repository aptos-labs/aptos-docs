---
title: "Usando Docker"
description: "Guía paso a paso para desplegar validator de Aptos y validator fullnode (VFN) usando contenedores Docker en máquinas separadas."
sidebar:
  label: "Docker"
---

import { Aside } from '@astrojs/starlight/components';

<Aside type="caution">
  **Usuarios Apple M1+** <br />
  El despliegue Docker solo ha sido probado en Linux, Windows, y macOS Intel. Si estás en macOS M1+, necesitarás
  desplegar usando [código fuente](/es/network/nodes/full-node/deployments/using-source-code).
</Aside>

Esta es una guía paso a paso para desplegar un validator de Aptos y validator fullnode (VFN) usando Docker. Usando esta guía, el validator
y VFN serán desplegados en máquinas separadas.

<Aside type="caution">
  **Prerrequisitos** <br />
  Antes de comenzar, asegúrate de leer y entender los [Requisitos del Nodo](/es/network/nodes/validator-node/node-requirements). Similarmente, asegúrate de haber
  instalado el [CLI de Aptos](/es/build/cli), y [Docker con Docker Compose](https://docs.docker.com/engine/install/).
</Aside>

## Pasos de despliegue

<Aside type="note">
  **Conexión por defecto a mainnet**<br />
  Si sigues la configuración por defecto en este documento, entonces tu validator y VFN estarán conectados a la mainnet de Aptos.
  Para conectarte a una red de Aptos diferente, como testnet, asegúrate de descargar los archivos génesis y waypoint
  correctos para la red a la que quieres conectarte. Similarmente, necesitarás modificar los archivos docker compose para usar las
  imágenes docker correctas por nombre de red.
</Aside>

1. Crea un directorio de trabajo para tus nodos Aptos, y elige un nombre de usuario para tus nodos, ej.,

   ```shellscript filename="Terminal"
   export WORKSPACE=mainnet
   export USERNAME=alice
   mkdir ~/$WORKSPACE
   cd ~/$WORKSPACE
   ```

2. Genera los pares de claves para tus nodos en tu directorio de trabajo. Puedes hacer esto ejecutando
   el siguiente comando con el CLI de Aptos:

   ```shellscript filename="Terminal"
   aptos genesis generate-keys --output-dir ~/$WORKSPACE/keys
   ```

   Esto creará 4 archivos de clave bajo el directorio `~/$WORKSPACE/keys`:

   - `public-keys.yaml`: Este archivo contiene todas las claves públicas para tu validator y VFN, así como tu dirección de cuenta.
   - `private-keys.yaml`: Este archivo contiene todas las claves privadas para tu validator y VFN.
   - `validator-identity.yaml`: Este archivo contiene las claves públicas y privadas para tu validator, así como tu dirección de cuenta.
   - `validator-full-node-identity.yaml`: Este archivo contiene las claves públicas y privadas para tu VFN, así como tu dirección de cuenta.

   <Aside type="caution">
     **Respalda tus claves privadas** <br />
     Tus claves privadas son importantes para que establezcas propiedad de tus nodos. Nunca compartas tus claves **privadas** con nadie,
     y asegúrate de **respaldar** `private-keys.yaml` en algún lugar seguro.
   </Aside>

3. Siguiente, necesitarás establecer tu configuración de validator. Esto incluye establecer los nombres de host del validator y VFN,
   que pueden ser direcciones IP o direcciones DNS.

   <Aside type="caution">
     **Direcciones DNS**<br />
     Se recomienda usar DNS sobre direcciones IP, ya que habilita migraciones de nodo más eficientes y es más resiliente
     a cambios de host.
   </Aside>

   Puedes establecer tu configuración de validator ejecutando el siguiente comando con el CLI de Aptos:

   ```shellscript filename="Terminal"

   # Reemplaza <validator node IP / DNS address> y <Full Node IP / DNS address> abajo,
   # con la dirección IP o DNS apropiada para tus nodos.

   cd ~/$WORKSPACE
   aptos genesis set-validator-configuration \
       --local-repository-dir ~/$WORKSPACE \
       --username $USERNAME \
       --owner-public-identity-file ~/$WORKSPACE/keys/public-keys.yaml \
       --validator-host <validator node IP / DNS address>:<Port> \
       --full-node-host <Full Node IP / DNS address>:<Port> \
       --stake-amount 100000000000000

   # Por ejemplo, si estás usando direcciones IP:

   aptos genesis set-validator-configuration \
       --local-repository-dir ~/$WORKSPACE \
       --username $USERNAME \
       --owner-public-identity-file ~/$WORKSPACE/keys/public-keys.yaml \
       --validator-host 35.232.235.205:6180 \
       --full-node-host 34.135.169.144:6182 \
       --stake-amount 100000000000000

   # De lo contrario, si estás usando direcciones DNS:

   aptos genesis set-validator-configuration \
       --local-repository-dir ~/$WORKSPACE \
       --username $USERNAME \
       --owner-public-identity-file ~/$WORKSPACE/keys/public-keys.yaml \
       --validator-host bot.aptosdev.com:6180 \
       --full-node-host fn.bot.aptosdev.com:6182 \
       --stake-amount 100000000000000
   ```

   Configurar el validator creará dos archivos YAML en el directorio `~/$WORKSPACE/$USERNAME`: `owner.yaml` y
   `operator.yaml`. Estos serán útiles para conectar tus nodos a la red de Aptos (después).

4. Descarga los siguientes archivos siguiendo las instrucciones en las páginas [Archivos del Nodo](/es/network/nodes/configure/node-files-all-networks).
   Necesitarás seleccionar la red apropiada (ej., `mainnet`, `testnet`, `devnet`) y descargar los siguientes archivos:

   - `validator.yaml`
   - `fullnode.yaml`
   - `docker-compose.yaml`
   - `docker-compose-fullnode.yaml`
   - `haproxy.cfg`
   - `haproxy-fullnode.cfg`
   - `blocked.ips`
   - `genesis.blob`
   - `waypoint.txt`

5. Para recapitular, en tu directorio de trabajo (`~/$WORKSPACE`), deberías tener una lista de archivos:

   - `docker-compose.yaml`: El archivo docker compose para ejecutar el validator.
   - `docker-compose-fullnode.yaml`: El archivo docker compose para ejecutar el VFN.
   - carpeta `keys` conteniendo:
     - `public-keys.yaml`: Claves públicas para ambos nodos.
     - `private-keys.yaml`: Claves privadas para ambos nodos.
     - `validator-identity.yaml`: Información de clave y cuenta para el validator.
     - `validator-full-node-identity.yaml`: Información de clave y cuenta para el VFN.
   - carpeta `$username` conteniendo:
     - `owner.yaml`: Los mapeos de propietario, operador y votante.
     - `operator.yaml`: Información del operador del validator y VFN.
   - `waypoint.txt`: El waypoint para la transacción génesis en la red a la que te estás conectando.
   - `genesis.blob` El blob génesis para la red a la que te estás conectando.

6. Para iniciar el nodo validator, ejecuta el siguiente comando en tu directorio de trabajo:

   ```shellscript filename="Terminal"
   docker-compose up (o `docker compose up` depende de tu versión)
   ```

   Esto iniciará el nodo validator usando el archivo docker compose y las imágenes especificadas en el
   archivo `docker-compose.yaml`. Si deseas cambiar la red a la que te estás conectando, necesitarás modificar
   el archivo para usar las imágenes docker correctas por nombre de red.

7. Antes de que puedas iniciar el VFN, necesitarás modificar el archivo `fullnode.yaml` para actualizar la dirección de host para el
   nodo validator. Por ejemplo, si estás usando direcciones IP, necesitarás actualizar las `full_node_networks`
   `addresses` para la red `vfn` como sigue:

   ```yaml filename="fullnode.yaml"
   ---
   addresses:
     - "/ip4/100.100.100.100/tcp/6181/noise-ik/..." # Establece la Dirección IP del validator
   ```

   De lo contrario, si estás usando direcciones DNS, necesitarás actualizar el campo `addresses` como sigue:

   ```yaml filename="fullnode.yaml"
   ---
   addresses:
     - "/dns/example.com/tcp/6181/noise-ik/..." # Establece la Dirección DNS del validator
   ```

8. Para iniciar tu VFN, ejecuta los siguientes comandos en una máquina VFN separada y dedicada. Necesitarás copiar
   las claves, configuración y archivos docker compose desde la máquina validator.

   <Aside type="caution">
     **Identidad VFN**<br />
     Deberías copiar las claves y archivos de configuración
     a la máquina VFN desde la ubicación de trabajo donde fueron generados. No intentes generar
     otro conjunto de claves o archivos para el VFN, ya que estos no serán reconocidos por la red.
   </Aside>

   Para iniciar el VFN, ejecuta el siguiente comando en tu directorio de trabajo:

   ```shellscript filename="Terminal"
   docker-compose -f docker-compose-fullnode.yaml up
   ```

   Esto iniciará el VFN usando el archivo docker compose y las imágenes especificadas en el
   archivo `docker-compose-fullnode.yaml`. Si deseas cambiar la red a la que te estás conectando, necesitarás modificar
   el archivo para usar las imágenes docker correctas por nombre de red.

   <Aside type="caution">
     **Siguientes pasos**<br />
     Ahora has completado la configuración de tu validator y VFN usando Docker. Sin embargo, tus nodos aún no podrán conectarse
     a la red de Aptos.
   </Aside>

## Conectarse a la Red de Aptos

Ahora has completado la configuración de tu validator y VFN usando Docker. Procede a [Conectar Nodos](/es/network/nodes/validator-node/connect-nodes) para los siguientes pasos.
