---
title: "Ваш Первый Модуль Move"
---

import { Aside, Steps } from '@astrojs/starlight/components';

Блокчейн Aptos позволяет разработчикам писать полные по Тьюрингу смарт-контракты (называемые "модули") с помощью безопасного по дизайну языка Move. Смарт-контракты позволяют пользователям отправлять деньги через блокчейн, а также писать произвольный код, даже игры! Все начинается с того, что Aptos CLI создает аккаунт, который будет хранить развернутый ("опубликованный") модуль Move.

Этот учебник поможет вам понять модули Move, проведя через настройку минимальной среды Aptos, а затем как компилировать, тестировать, публиковать и взаимодействовать с модулями Move в блокчейне Aptos. Вы узнаете как:

1. Настроить среду, установить CLI
2. Создать аккаунт devnet и профинансировать его
3. Компилировать и тестировать модуль Move
4. Публиковать (или "разворачивать") модуль Move в блокчейне Aptos
5. Взаимодействовать с модулем
6. Продолжить создание с Aptos (следующие шаги)

<Aside type="note">
  Этот учебник не предназначен для обучения основам Move. Это более длинная тема, которую лучше изучать через [Книгу Move](/ru/build/smart-contracts/book).
</Aside>

## 1. Настройка

Изменения в блокчейне называются "транзакциями", и они требуют аккаунт для оплаты сетевой комиссии ("комиссия за газ"). Нам нужно будет создать аккаунт с некоторым количеством APT для оплаты этой комиссии и владения опубликованным контрактом. Для этого нам понадобится использовать Aptos CLI.

<Steps>
  1. Установить Aptos CLI

     [Установите Aptos CLI](/ru/build/cli) (если еще не установили).

  2. Открыть новый терминал

     Откройте новое окно терминала или вкладку.

  3. Проверить установку

     Запустите `aptos --version` для проверки установки.

     ```shellscript filename="Terminal"
     aptos --version
     ```

     Вы должны увидеть ответ типа `aptos 4.6.1`.

  4. Создать папку проекта

     Создайте новую папку для этого учебника, запустив:

     ```shellscript filename="Terminal"
     mkdir my-first-module
     ```

  5. Перейти в папку проекта

     Запустите `cd my-first-module` для перехода в вашу новую папку.

  6. Инициализировать ваш аккаунт

     Запустите `aptos init` и нажимайте 'enter' для каждого шага настройки, чтобы создать тестовый аккаунт в `devnet`.

     <Aside type="note">
       Пока мы настраиваем ваш Aptos CLI для этой папки, заметьте, что эта настройка следует логике самого блокчейна:

       1. С какой сетью мы работаем (по умолчанию `devnet`, который обновляется каждую неделю)?
       2. Какой аккаунт мы используем для транзакций (создание уникального приватного ключа, который в свою очередь генерирует криптографический публичный ключ и адрес аккаунта)?
       3. Как я плачу за "газ"? (Для devnet, testnet и локальных сетей Aptos CLI любезно профинансирует этот аккаунт Aptos Coin, APT).

       Пока просто нажимайте 'enter' повторно, чтобы принять все значения по умолчанию.
     </Aside>

     Вы должны увидеть сообщение об успехе, подобное этому:

     ```shellscript filename="Terminal"
     ---
     Aptos CLI is now set up for account 0x9ec1cfa30b885a5c9d595f32f3381ec16d208734913b587be9e210f60be9f9ba as profile default!
     {
       "Result": "Success"
     }
     ```

  7. Фондировать ваш аккаунт

     Запустите `aptos account fund-with-faucet --account default` для добавления APT на ваш аккаунт:

     ```shellscript filename="Terminal"
     aptos account fund-with-faucet --account default
     ```

     Вы должны увидеть сообщение об успехе:

     ```shellscript filename="Terminal"
     {
       "Result": "Added 100000000 Octas to account 9ec1cfa30b885a5c9d595f32f3381ec16d208734913b587be9e210f60be9f9ba"
     }
     ```

  8. Проверить баланс аккаунта

     Запустите `aptos account balance` для проверки баланса вашего аккаунта:

     ```shellscript filename="Terminal"
     aptos account balance
     ```

     Вы должны увидеть что-то вроде:

     ```shellscript filename="Terminal"
     {
       "Result": "100000000"
     }
     ```

     Это означает, что у вас есть 1 APT (помните, 1 APT = 100,000,000 Octas).
</Steps>

## 2. Создание Модуля Move

Теперь создадим простой модуль Move. Модуль похож на библиотеку или пакет в других языках программирования - он содержит функции и структуры данных.

<Steps>
  1. Инициализировать проект Move

     Запустите `aptos move init --name hello_blockchain` для создания новой структуры проекта Move:

     ```shellscript filename="Terminal"
     aptos move init --name hello_blockchain
     ```

     Это создаст следующую структуру папок:

     ```
     my-first-module/
     ├── Move.toml          # Конфигурация проекта
     └── sources/           # Ваши исходные файлы Move
     ```

  2. Создать исходный файл

     Создайте новый файл `sources/hello_blockchain.move`:

     ```shellscript filename="Terminal"
     touch sources/hello_blockchain.move
     ```

  3. Добавить код модуля

     Откройте `sources/hello_blockchain.move` в вашем редакторе и добавьте следующий код:

     ```move filename="sources/hello_blockchain.move"
     module hello_blockchain::message {
         use std::error;
         use std::signer;
         use std::string;
         use aptos_framework::event;

         //:!:>resource
         struct MessageHolder has key {
             message: string::String,
         }
         //<:!:resource

         #[event]
         struct MessageChange has drop, store {
             account: address,
             from_message: string::String,
             to_message: string::String,
         }

         /// Не существует MessageHolder ресурса под адресом аккаунта
         const E_NO_MESSAGE: u64 = 0;

         #[view]
         public fun get_message(addr: address): string::String acquires MessageHolder {
             assert!(exists<MessageHolder>(addr), error::not_found(E_NO_MESSAGE));
             borrow_global<MessageHolder>(addr).message
         }

         public entry fun set_message(account: signer, message: string::String)
         acquires MessageHolder {
             let account_addr = signer::address_of(&account);
             if (!exists<MessageHolder>(account_addr)) {
                 move_to(&account, MessageHolder {
                     message,
                 })
             } else {
                 let old_message = borrow_global_mut<MessageHolder>(account_addr);
                 let from_message = old_message.message;
                 event::emit(MessageChange {
                     account: account_addr,
                     from_message,
                     to_message: copy message,
                 });
                 old_message.message = message;
             }
         }

         #[test(admin = @0x123)]
         public entry fun sender_can_set_message(admin: signer) acquires MessageHolder {
             let addr = signer::address_of(&admin);
             aptos_framework::account::create_account_for_test(addr);
             set_message(admin, string::utf8(b"Hello, Blockchain"));

             assert!(
               get_message(addr) == string::utf8(b"Hello, Blockchain"),
               E_NO_MESSAGE
             );
         }
     }
     ```

     Этот модуль:

     - Определяет ресурс `MessageHolder` для хранения строки сообщения
     - Имеет функцию `set_message` для установки сообщения аккаунта
     - Имеет функцию `get_message` для чтения сообщения аккаунта
     - Включает базовый тест
</Steps>

<Aside type="note">
  **Понимание кода:**

  - `module hello_blockchain::message` объявляет модуль под названием `message` в пакете `hello_blockchain`
  - `struct MessageHolder has key` определяет ресурс, который может быть сохранен в глобальном хранилище
  - `public entry fun` создает функции, которые могут быть вызваны извне
  - `#[view]` указывает, что функция только читает данные
  - `acquires MessageHolder` требуется для функций, которые читают/изменяют этот ресурс
</Aside>

## 3. Компиляция и Тестирование

<Steps>
  1. Компилировать модуль

     Запустите `aptos move compile` для компиляции вашего модуля:

     ```shellscript filename="Terminal"
     aptos move compile
     ```

     Если все пройдет хорошо, вы увидите:

     ```shellscript filename="Terminal"
     Compiling, may take a little while to download git dependencies...
     UPDATING GIT DEPENDENCY https://github.com/aptos-labs/aptos-core.git
     INCLUDING DEPENDENCY AptosFramework
     INCLUDING DEPENDENCY AptosStdlib
     INCLUDING DEPENDENCY MoveStdlib
     BUILDING hello_blockchain
     {
       "Result": "Success"
     }
     ```

  2. Запустить тесты

     Запустите `aptos move test` для выполнения тестов:

     ```shellscript filename="Terminal"
     aptos move test
     ```

     Вы должны увидеть:

     ```shellscript filename="Terminal"
     Compiling, may take a little while to download git dependencies...
     BUILDING hello_blockchain
     Running Move unit tests
     [ PASS    ] 0xf8f6f2::message::sender_can_set_message
     Test result: OK. Total tests: 1; passed: 1; failed: 0
     {
       "Result": "Success"
     }
     ```

  3. Исправить любые ошибки

     Если у вас есть ошибки компиляции или тестов, внимательно прочитайте сообщения об ошибках и исправьте код.
</Steps>

## 4. Публикация Модуля

Теперь опубликуем наш модуль в блокчейне!

<Steps>
  1. Опубликовать модуль

     Запустите `aptos move publish` для развертывания вашего модуля:

     ```shellscript filename="Terminal"
     aptos move publish
     ```

     Вы увидите информацию о транзакции и будет предложено подтвердить:

     ```shellscript filename="Terminal"
     Compiling, may take a little while to download git dependencies...
     BUILDING hello_blockchain
     package size 1755 bytes
     Do you want to submit a transaction for a range of [194800 - 292200] Octas at a gas unit price of 100 Octas? [yes/no]
     ```

     Введите `yes` и нажмите Enter.

  2. Подтвердить публикацию

     После успешной публикации вы увидите что-то вроде:

     ```shellscript filename="Terminal"
     {
       "Result": {
         "transaction_hash": "0x45c0f6f1b208e2f....",
         "gas_used": 1947,
         "gas_unit_price": 100,
         "sender": "9ec1cfa30b885a5c9d595f32f3381ec16d208734913b587be9e210f60be9f9ba",
         "sequence_number": 0,
         "success": true,
         "timestamp_us": 1685077849297587,
         "version": 528422121,
         "vm_status": "Executed successfully"
       }
     }
     ```

     Поздравляем! Ваш модуль теперь в блокчейне.
</Steps>

## 5. Взаимодействие с Модулем

Теперь давайте взаимодействовать с нашим опубликованным модулем.

<Steps>
  1. Установить сообщение

     Вызовите функцию `set_message` для установки сообщения:

     ```shellscript filename="Terminal"
     aptos move run \
       --function-id 'default::message::set_message' \
       --args 'string:Hello, Aptos!'
     ```

     <Aside type="note">
       - `default::message::set_message` ссылается на функцию `set_message` в модуле `message` вашего аккаунта по умолчанию
       - `string:Hello, Aptos!` передает строковый аргумент функции
     </Aside>

     Вы увидите результат транзакции:

     ```shellscript filename="Terminal"
     {
       "Result": {
         "transaction_hash": "0x1d644eba8187fa8475...",
         "gas_used": 736,
         "gas_unit_price": 100,
         "sender": "9ec1cfa30b885a5c9d595f32f3381ec16d208734913b587be9e210f60be9f9ba",
         "sequence_number": 1,
         "success": true,
         "timestamp_us": 1685077973499641,
         "version": 528422122,
         "vm_status": "Executed successfully"
       }
     }
     ```

  2. Прочитать сообщение

     Вызовите функцию `get_message` для чтения сообщения:

     ```shellscript filename="Terminal"
     aptos move view \
       --function-id 'default::message::get_message' \
       --args 'address:default'
     ```

     <Aside type="note">
       - `view` используется для функций только для чтения (не изменяют состояние)
       - `address:default` передает адрес вашего аккаунта по умолчанию
     </Aside>

     Вы должны увидеть ваше сохраненное сообщение:

     ```shellscript filename="Terminal"
     {
       "Result": [
         "Hello, Aptos!"
       ]
     }
     ```

  3. Обновить сообщение

     Давайте изменим сообщение:

     ```shellscript filename="Terminal"
     aptos move run \
       --function-id 'default::message::set_message' \
       --args 'string:Hello, Move!'
     ```

     Прочитайте его снова, чтобы подтвердить изменение:

     ```shellscript filename="Terminal"
     aptos move view \
       --function-id 'default::message::get_message' \
       --args 'address:default'
     ```

     Результат:

     ```shellscript filename="Terminal"
     {
       "Result": [
         "Hello, Move!"
       ]
     }
     ```
</Steps>

## 6. Изучение в Aptos Explorer

Вы также можете видеть ваш модуль и транзакции в Aptos Explorer:

<Steps>
  1. Перейти в Aptos Explorer

     Откройте [Aptos Explorer](https://explorer.aptoslabs.com/) в вашем браузере.

  2. Переключиться на Devnet

     В правом верхнем углу убедитесь, что выбрана сеть "Devnet".

  3. Найти ваш аккаунт

     Скопируйте адрес вашего аккаунта из вывода CLI и вставьте его в поисковую строку.

  4. Изучить ваш аккаунт

     Вы увидите:

     - Баланс аккаунта
     - Опубликованные модули
     - Историю транзакций
     - Ресурсы (включая ваш MessageHolder)
</Steps>

## Понимание Move

Давайте глубже рассмотрим ключевые концепции Move:

### Ресурсы

```move
struct MessageHolder has key {
    message: string::String,
}
```

- **Ресурсы** - это структуры данных, которые могут быть сохранены в глобальном хранилище
- `has key` означает, что эта структура может быть сохранена под адресом аккаунта
- Ресурсы уникальны - они не могут быть скопированы или случайно удалены

### Функции Entry

```move
public entry fun set_message(account: signer, message: string::String)
```

- `public entry` функции могут быть вызваны извне (из транзакций)
- `signer` представляет аккаунт, подписывающий транзакцию
- Эти функции могут изменять состояние блокчейна

### View Функции

```move
#[view]
public fun get_message(addr: address): string::String
```

- `#[view]` функции только читают данные
- Они не могут изменять состояние
- Они могут быть вызваны без отправки транзакции

### Глобальные Операции Хранилища

```move
// Проверить, существует ли ресурс
exists<MessageHolder>(addr)

// Переместить ресурс в хранилище
move_to(&account, MessageHolder { message })

// Заимствовать ресурс
borrow_global<MessageHolder>(addr)

// Изменяемо заимствовать ресурс
borrow_global_mut<MessageHolder>(addr)
```

## Лучшие Практики

### 1. Обработка Ошибок

```move
/// Коды ошибок
const E_NO_MESSAGE: u64 = 0;
const E_INVALID_MESSAGE: u64 = 1;

public fun get_message(addr: address): string::String acquires MessageHolder {
    assert!(exists<MessageHolder>(addr), error::not_found(E_NO_MESSAGE));
    borrow_global<MessageHolder>(addr).message
}
```

### 2. События

```move
#[event]
struct MessageChange has drop, store {
    account: address,
    from_message: string::String,
    to_message: string::String,
}

// Эмитировать событие
event::emit(MessageChange {
    account: account_addr,
    from_message,
    to_message: copy message,
});
```

### 3. Тестирование

```move
#[test(admin = @0x123)]
public entry fun test_set_message(admin: signer) acquires MessageHolder {
    let addr = signer::address_of(&admin);
    aptos_framework::account::create_account_for_test(addr);
    
    set_message(admin, string::utf8(b"Test Message"));
    
    assert!(
        get_message(addr) == string::utf8(b"Test Message"),
        E_NO_MESSAGE
    );
}
```

## Следующие Шаги

Поздравляем! Вы успешно создали, развернули и взаимодействовали с вашим первым модулем Move. Вот некоторые следующие шаги для продолжения обучения:

### 1. Изучить Move Глубже

- **[Книга Move](/ru/build/smart-contracts/book)** - Полное руководство по языку Move
- **[Стандартная библиотека](/ru/build/smart-contracts/book/standard-library)** - Встроенные модули и функции
- **[Примеры Move](https://github.com/aptos-labs/aptos-core/tree/main/aptos-move/move-examples)** - Репозиторий с примерами

### 2. Создать Больше Сложных Модулей

- **[Создание токенов](/ru/build/guides/first-coin)** - Создайте свою собственную криптовалюту
- **[NFT разработка](/ru/build/guides/your-first-nft)** - Создавайте уникальные цифровые активы
- **[DeFi протоколы](/ru/build/smart-contracts/digital-asset)** - Создавайте финансовые приложения

### 3. Построить Полный dApp

- **[E2E dApp руководство](/ru/build/guides/build-e2e-dapp)** - Создайте полноценное децентрализованное приложение
- **[Frontend интеграция](/ru/build/sdks/ts-sdk)** - Подключите к веб-приложению
- **[Wallet интеграция](/ru/build/sdks/wallet-adapter)** - Добавьте поддержку кошельков

### 4. Продвинутые Темы

- **[Мультисиг аккаунты](/ru/build/guides/first-multisig)** - Безопасность множественных подписей
- **[Спонсируемые транзакции](/ru/build/guides/sponsored-transactions)** - Улучшите UX
- **[Индексация данных](/ru/build/indexer)** - Эффективные запросы блокчейна

## Устранение Неполадок

### Распространенные Ошибки

**Ошибка компиляции: "could not find package"**

```
error: could not find package `hello_blockchain` in ...
```

- Убедитесь, что `Move.toml` существует и правильно настроен
- Проверьте название пакета в `Move.toml`

**Ошибка публикации: "INSUFFICIENT\_BALANCE\_FOR\_TRANSACTION\_FEE"**

```
error: INSUFFICIENT_BALANCE_FOR_TRANSACTION_FEE
```

- Профинансируйте ваш аккаунт: `aptos account fund-with-faucet --account default`

**Ошибка выполнения: "FUNCTION\_NOT\_FOUND"**

```
error: FUNCTION_NOT_FOUND
```

- Проверьте правильность ID функции
- Убедитесь, что модуль опубликован

**Ошибка ресурса: "RESOURCE\_NOT\_FOUND"**

```
error: RESOURCE_NOT_FOUND
```

- Убедитесь, что ресурс был создан раньше
- Проверьте адрес аккаунта

### Получение Помощи

- **[Discord сообщество](https://discord.gg/aptoslabs)** - Задавайте вопросы и получайте помощь
- **[GitHub Issues](https://github.com/aptos-labs/aptos-core/issues)** - Сообщайте о багах
- **[Stack Overflow](https://stackoverflow.com/questions/tagged/aptos)** - Технические вопросы
- **[Форум разработчиков](https://forum.aptoslabs.com/)** - Обсуждения сообщества

Добро пожаловать в экосистему Aptos! Продолжайте изучать и создавать удивительные dApps. 🚀
