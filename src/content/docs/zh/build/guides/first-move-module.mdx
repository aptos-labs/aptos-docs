---
title: "您的第一个Move模块"
description: "学习在 Aptos 区块链上编译、测试、发布和与 Move 智能合约交互，从设置到部署的完整过程。"
sidebar:
  label: "第一个Move模块"
---

import { Aside, Steps } from '@astrojs/starlight/components';

Aptos区块链允许开发者使用安全设计的Move语言编写图灵完备的智能合约（称为"模块"）。智能合约不仅能让用户通过区块链发送资金，还能编写任意代码，甚至游戏！这一切都始于使用Aptos CLI创建一个账户，该账户将存储已部署（"发布"）的Move模块。

本教程将通过指导您设置最小的Aptos环境，然后如何在Aptos区块链上编译、测试、发布和与Move模块交互，帮助您理解Move模块。您将学习如何：

1. 设置环境，安装CLI
2. 创建开发网账户并为其提供资金
3. 编译和测试Move模块
4. 将Move模块发布（或"部署"）到Aptos区块链
5. 与模块交互
6. 继续使用Aptos构建（下一步）

<Aside type="note">
  本教程不是为了教您Move的基础知识。那是一个更长的主题，最好通过[Move书籍](/zh/build/smart-contracts/book)来学习。
</Aside>

## 1. 设置

对区块链的更改称为"交易"，它们需要一个账户来支付网络费用（"gas费"）。我们需要创建一个拥有一些APT的账户来支付该费用并拥有已发布的合约。为了做到这一点，我们需要使用Aptos CLI。

<Steps>
  1. 安装Aptos CLI

     [安装Aptos CLI](/zh/build/cli)（如果您还没有安装）。

  2. 打开新终端

     打开新的终端窗口或标签。

  3. 验证安装

     运行`aptos --version`来验证您已安装。

     ```shellscript filename="终端"
     aptos --version
     ```

     您应该看到类似`aptos 4.6.1`的响应。

  4. 创建项目文件夹

     通过运行以下命令为本教程创建新文件夹：

     ```shellscript filename="终端"
     mkdir my-first-module
     ```

  5. 导航到项目文件夹

     运行`cd my-first-module`进入您的新文件夹。

  6. 初始化您的账户

     运行`aptos init`并为每个设置步骤按"回车"，在`devnet`上创建测试账户。

     <Aside type="note">
       当我们为此文件夹配置您的Aptos CLI时，请注意此设置遵循区块链本身的逻辑：

       1. 我们正在使用哪个网络（默认`devnet`，每周刷新一次）？
       2. 我们从哪个账户进行交易（创建唯一私钥，进而生成加密公钥和账户地址）？
       3. 我如何支付"gas"？（对于devnet、testnet和本地网络，Aptos CLI将帮助为此账户提供Aptos币，APT）。

       现在，只需重复按"回车"接受所有默认值。
     </Aside>

     您应该看到这样的成功消息：

     ```shellscript filename="终端"
     ---
     Aptos CLI is now set up for account 0x9ec1cfa30b885a5c9d595f32f3381ec16d208734913b587be9e210f60be9f9ba as profile default!
     {
       "Result": "Success"
     }
     ```

     <Aside type="note">
       您可能没有注意到的是，Aptos CLI已经创建了一个新的隐藏文件夹`.aptos/`，其中包含`.gitignore`和`config.yaml`，其中包含账户信息，包括私钥、公钥和账户地址。

       您可以在Unix/Mac终端中使用`ls -a`或在Windows中使用`dir /ah`查看隐藏文件。
     </Aside>
</Steps>

## 2. 创建Move模块

现在让我们创建一个简单的Move模块。

<Steps>
  1. 初始化Move包

     运行以下命令创建一个新的Move包：

     ```shellscript filename="终端"
     aptos move init --name hello_blockchain
     ```

     这将创建一个基本的Move项目结构：

     ```
     my-first-module/
     ├── Move.toml
     └── sources/
     ```

  2. 创建模块文件

     在`sources/`目录中创建一个名为`hello_blockchain.move`的文件：

     ```move filename="sources/hello_blockchain.move"
     module hello_blockchain::message {
         use std::error;
         use std::signer;
         use std::string;
         use aptos_framework::account;
         use aptos_framework::event;

         //:!:>resource
         struct MessageHolder has key {
             message: string::String,
         }
         //<:!:resource

         #[event]
         struct MessageChange has drop, store {
             account: address,
             from_message: string::String,
             to_message: string::String,
         }

         /// 没有消息时抛出的错误
         const E_NO_MESSAGE: u64 = 0;

         #[view]
         public fun get_message(addr: address): string::String acquires MessageHolder {
             assert!(exists<MessageHolder>(addr), error::not_found(E_NO_MESSAGE));
             borrow_global<MessageHolder>(addr).message
         }

         public entry fun set_message(account: signer, message: string::String)
         acquires MessageHolder {
             let account_addr = signer::address_of(&account);
             if (!exists<MessageHolder>(account_addr)) {
                 move_to(&account, MessageHolder {
                     message,
                 })
             } else {
                 let old_message_holder = borrow_global_mut<MessageHolder>(account_addr);
                 let from_message = old_message_holder.message;
                 event::emit(MessageChange {
                     account: account_addr,
                     from_message,
                     to_message: copy message,
                 });
                 old_message_holder.message = message;
             }
         }

         #[test(account = @0x1)]
         public entry fun sender_can_set_message(account: signer) acquires MessageHolder {
             let addr = signer::address_of(&account);
             aptos_framework::account::create_account_for_test(addr);
             set_message(account, string::utf8(b"Hello, Blockchain"));

             assert!(
                 get_message(addr) == string::utf8(b"Hello, Blockchain"),
                 E_NO_MESSAGE
             );
         }
     }
     ```
</Steps>

## 3. 编译和测试模块

<Steps>
  1. 编译模块

     ```shellscript filename="终端"
     aptos move compile
     ```

     如果编译成功，您将看到：

     ```shellscript filename="终端"
     Compiling, may take a little while to download git dependencies...
     INCLUDING DEPENDENCY AptosFramework
     INCLUDING DEPENDENCY AptosStdlib
     INCLUDING DEPENDENCY MoveStdlib
     BUILDING hello_blockchain
     {
       "Result": "Success"
     }
     ```

  2. 运行测试

     ```shellscript filename="终端"
     aptos move test
     ```

     您应该看到测试通过：

     ```shellscript filename="终端"
     INCLUDING DEPENDENCY AptosFramework
     INCLUDING DEPENDENCY AptosStdlib
     INCLUDING DEPENDENCY MoveStdlib
     BUILDING hello_blockchain
     Running Move unit tests
     [ PASS    ] 0x9ec1cfa30b885a5c9d595f32f3381ec16d208734913b587be9e210f60be9f9ba::message::sender_can_set_message
     Test result: OK. Total tests: 1; passed: 1; failed: 0
     {
       "Result": "Success"
     }
     ```
</Steps>

## 4. 发布模块

现在让我们将模块发布到区块链。

<Steps>
  1. 发布模块

     ```shellscript filename="终端"
     aptos move publish
     ```

     系统会询问您是否要发布，键入`yes`并按回车：

     ```shellscript filename="终端"
     Compiling, may take a little while to download git dependencies...
     INCLUDING DEPENDENCY AptosFramework
     INCLUDING DEPENDENCY AptosStdlib
     INCLUDING DEPENDENCY MoveStdlib
     BUILDING hello_blockchain
     package size 1755 bytes
     Do you want to publish this package at address 0x9ec1cfa30b885a5c9d595f32f3381ec16d208734913b587be9e210f60be9f9ba [yes/no] >
     ```

     发布成功后，您将看到：

     ```shellscript filename="终端"
     {
       "Result": "Success"
     }
     ```
</Steps>

## 5. 与模块交互

现在我们的模块已发布，让我们与它交互。

<Steps>
  1. 设置消息

     ```shellscript filename="终端"
     aptos move run \
       --function-id 'default::message::set_message' \
       --args 'string:Hello, Aptos!'
     ```

     您应该看到交易成功：

     ```shellscript filename="终端"
     {
       "Result": "Success"
     }
     ```

  2. 查看消息

     ```shellscript filename="终端"
     aptos move view \
       --function-id 'default::message::get_message' \
       --args 'address:default'
     ```

     您应该看到您的消息：

     ```shellscript filename="终端"
     {
       "Result": [
         "Hello, Aptos!"
       ]
     }
     ```
</Steps>

## 6. 理解代码

让我们分解一下您刚刚创建的Move模块：

### 模块声明

```move
module hello_blockchain::message {
```

这声明了一个名为`message`的模块，位于`hello_blockchain`地址。

### 结构体定义

```move
struct MessageHolder has key {
    message: string::String,
}
```

这定义了一个可以存储在账户中的资源（`has key`）。

### 函数

- `set_message`: 允许账户设置或更新他们的消息
- `get_message`: 允许任何人读取存储在地址上的消息

### 测试

```move
#[test(account = @0x1)]
public entry fun sender_can_set_message(account: signer) acquires MessageHolder {
```

这是一个单元测试，验证模块按预期工作。

## 下一步

恭喜！您已经成功：

1. ✅ 设置了Aptos开发环境
2. ✅ 创建了您的第一个Move模块
3. ✅ 编译和测试了模块
4. ✅ 将模块发布到区块链
5. ✅ 与已发布的模块交互

### 继续学习

- [Move语言书籍](/zh/build/smart-contracts/book) - 深入学习Move编程
- [构建端到端DApp](/zh/build/guides/build-e2e-dapp) - 创建完整的去中心化应用
- [Aptos标准](/zh/build/smart-contracts/aptos-standards) - 了解Aptos代币标准
- [Move示例](https://github.com/aptos-labs/aptos-core/tree/main/aptos-move/move-examples) - 探索更多Move代码示例

<Aside type="tip">
  **下一个项目想法**：

  - 创建一个计数器模块，允许用户递增和递减数字
  - 构建一个简单的待办事项列表模块
  - 实现一个基本的投票系统
</Aside>
